---
import BaseLayout from "../layouts/BaseLayout.astro";
import { supabase } from "../lib/supabase";
---

<BaseLayout title="dashboard">
  <h1 id="welcome-message">Chargement...</h1>
  <p id="welcome-text">Veuillez patienter...</p>

  <script>
    import { supabase } from "../lib/supabase";

    document.addEventListener("DOMContentLoaded", async () => {
      const { data, error } = await supabase.auth.getUser();
      console.log("Supabase auth response:", data, error);

      if (error || !data?.user) {
        console.log("Redirection vers /signin...");
        window.location.href = "/signin";
      } else {
        console.log("Utilisateur récupéré:", data.user);
        const welcomeMessage = document.getElementById("welcome-message");
        const welcomeText = document.getElementById("welcome-text");

        if (welcomeMessage && welcomeText) {
          welcomeMessage.innerText = `Bienvenue ${data.user.email}`;
          welcomeText.innerText = "Nous sommes heureux de vous voir ici.";
        }
      }
    });
  </script>

  <form action="/api/auth/signout">
    <button type="submit">Se déconnecter</button>
  </form>
</BaseLayout>
